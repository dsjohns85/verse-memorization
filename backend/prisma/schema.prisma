// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  name          String?
  azureAdId     String?  @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  verses        Verse[]
  reviews       Review[]
  
  @@map("users")
}

model Verse {
  id            String   @id @default(cuid())
  reference     String
  text          String
  translation   String   @default("NIV")
  userId        String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  reviews       Review[]
  
  @@map("verses")
  @@index([userId])
}

model Review {
  id            String   @id @default(cuid())
  verseId       String
  userId        String
  quality       Int      // 0-5 rating for recall quality
  easeFactor    Float    @default(2.5)
  interval      Int      @default(1) // Days until next review
  repetitions   Int      @default(0)
  nextReviewAt  DateTime
  reviewedAt    DateTime @default(now())
  createdAt     DateTime @default(now())
  
  verse         Verse    @relation(fields: [verseId], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("reviews")
  @@index([userId])
  @@index([verseId])
  @@index([nextReviewAt])
}
